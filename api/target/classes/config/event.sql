DROP EVENT IF EXISTS `day_of_clean_message_event`;
DELIMITER ;;
CREATE DEFINER=`root`@`%` EVENT `day_of_clean_message_event` ON SCHEDULE EVERY 1 HOUR STARTS '2019-01-01 00:00:00'
  ON COMPLETION PRESERVE ENABLE DO DELETE FROM message WHERE time < (UNIX_TIMESTAMP(now())-12*60*60)*1000
;

DROP EVENT IF EXISTS `day_of_clean_message_store_event`;
DELIMITER ;;
CREATE DEFINER=`root`@`%` EVENT `day_of_clean_message_store_event` ON SCHEDULE EVERY 1 HOUR STARTS '2019-01-01 00:00:00'
  ON COMPLETION PRESERVE ENABLE DO DELETE FROM message_store WHERE time < (UNIX_TIMESTAMP(now())-30*24*60*60)*1000
;


# tigase
DELETE FROM `msg_history` WHERE ts < DATE_ADD(CURRENT_TIMESTAMP(),INTERVAL -12 HOUR);


DROP EVENT IF EXISTS `delete_msg_history_schedule`;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` EVENT `delete_msg_history_schedule` ON SCHEDULE EVERY 1 HOUR STARTS '2018-07-04 14:02:35' ON COMPLETION NOT PRESERVE ENABLE DO BEGIN
  DELETE FROM `msg_history` WHERE ts < DATE_ADD(CURRENT_TIMESTAMP(),INTERVAL -6 HOUR);
END
;;


DROP EVENT IF EXISTS `delete_ma_msg_schedule`;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` EVENT `delete_ma_msg_schedule` ON SCHEDULE EVERY 1 HOUR STARTS '2018-07-04 14:02:35' ON COMPLETION NOT PRESERVE ENABLE DO BEGIN
  DELETE FROM `tig_ma_msgs` WHERE ts  < DATE_ADD(CURRENT_TIMESTAMP(),INTERVAL -6 HOUR);
END